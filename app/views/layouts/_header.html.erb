<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <%= link_to "Xero Service", root_path, class: "navbar-brand home-link left-margin" %>
  <div class="collapse navbar-collapse" id="navbarNavDropdown">
    <ul class="navbar-nav">
      <li class="nav-item active">
        <% if current_user&.user_token %>
          <%= link_to "Home", '/application/home', method: :get, class: "nav-link" %>
        <% end %>
      </li>
      <% if current_user&.user_token&.token_set%>
        <li class="nav-item dropdown">
          <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">Xero settings</button>
          <ul class="dropdown-menu">
            <li><%= link_to "Revoke Token", '/revoke_token', method: :post, class: "dropdown-item" %></li>
            <li><%= link_to "Refresh Token", '/refresh_token', method: :post, class: "dropdown-item" %></li>
            <% if current_user.user_token.token_set['connections'] && current_user.user_token.active_tenant_id %>
              <% selected = current_user.user_token.token_set['connections'].filter{|t| t['tenantId'] == current_user.user_token.active_tenant_id }[0] %>
              <li><%= link_to 'Disconnect Org', { controller: 'application', action: 'disconnect', connection_id: selected['id'] }, method: :post, class: "dropdown-item" %></li>
              <li>
                <%= form_for 'change_organisation', url: change_organisation_path, method: :post, class: "form-control" do |f| %>
                  <%= f.select  'Active tenand id', options_for_select(current_user.user_token.token_set['connections'].map { |c| [c['tenantName'], c['tenantId']] }, promp: "wedw"),{ promp: "Organisation" }, { class: "form-control"} %>
                  <br>
                  <%= f.submit "Change Org", class: "btn btn-small btn-primary mx-2" %>
                <% end %>
              </li>
            <% end %>
          </ul>
        <li>
      <% end %>
    </ul>
    <ul class="navbar-nav ms-auto">
      <% if current_user %>
        <li class="nav-item"> <%= link_to "Edit Account", edit_user_registration_path, class: "nav-link" %></li>
        <li class="nav-item"> <%= button_to "Sign Out", destroy_user_session_path, method: :delete, class: "btn btn-small btn-primary mx-2" %></li>
      <% else %>
        <li class="nav-item"> <%= link_to "Sign Up", new_user_registration_path, class: "nav-link" %></li>
        <li class="nav-item"> <%= link_to "Sign In", new_user_session_path, class: "nav-link" %></li>
      <% end %>
    </ul>
  </div>
</nav>
